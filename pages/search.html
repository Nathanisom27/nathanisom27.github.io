---
layout: default
permalink: /search/index.html
---
<!-- derived from http://katydecorah.com/code/lunr-and-jekyll/ -->

<div class="search">
	<input placeholder="Search&hellip;" type="search" id="search" class="search-input center search">
</div>

<div class="listing">
	<div id="results" class="all-posts results"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.0.1/lunr.min.js"></script>

<script>
var index = lunr(function () {
  this.field('title')
  this.field('content', {boost: 10})
  this.field('category')
  this.field('tags')
  this.ref('id')

{% assign count = 0 %}{% for post in site.posts %}
	this.add({
	  title: {{post.title | jsonify}},
	  category: {{post.category | jsonify}},
	  content: {{post.content | strip_html | jsonify}},
	  tags: {{post.tags | jsonify}},
	  id: {{count}}
	});
{% assign count = count | plus: 1 %}{% endfor %}
});

// builds reference data
var store = [
{% for post in site.posts %}
{
  "title": {{post.title | jsonify}},
  "link": {{ post.url | jsonify }},
  "date": {{ post.date | date_to_string | jsonify }},
  "excerpt": {{ post.content | strip_html | truncatewords: 20 | jsonify }}
}
{% unless forloop.last %},{% endunless %}{% endfor %}]

// builds search
document.addEventListener("DOMContentLoaded", function(event) {
  document.getElementById('search').addEventListener('keyup', function () {
    var resultdiv = document.getElementById('results');
    // Get query
    var query = document.getElementById('search').value;
    // Search for it
    var result = index.search("*" + query + "*");
    // Show results
    resultdiv.innerHTML = '';
    // Loop through, match, and add results
    for (var item in result) {
      var ref = result[item].ref;
      var searchitem = '<a href="'+store[ref].link+'"><div><h3>'+store[ref].title+'</h3><span class=right>'+store[ref].date+'</span></div><p>'+store[ref].excerpt+'</p></a>' ;
      var insert = document.createElement('span');
      insert.innerHTML = searchitem;
      resultdiv.appendChild(insert);
    }
  });
});
</script>
