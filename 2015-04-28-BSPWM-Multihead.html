<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-01-23 Thu 17:40 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>i3-like multihead in bspwm</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="./assets/css/notes.css">
<link rel="stylesheet" href="./assets/css/scaffold.css">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">i3-like multihead in bspwm</h1>
<div class="org-center">
<p>
[ published <span class="timestamp-wrapper"><span class="timestamp">2015-04-28</span></span> ¦ <a href="https://github.com/neeasade/neeasade.github.io/commits/source/posts/2015-04-28-BSPWM-Multihead.org">edited 2019-02-24</a> ¦ <a href="./index.html">Index</a> ]
</p>
</div>

<p>
i3 has fantastic focus and window handling for multiple monitors out of
the box in my opinion. I didn't realize that I missed this until I was
on campus and used i3 on a multihead setup there, so I set out to make
my bspwm setup act the same.
</p>

<div id="outline-container-org41ca577" class="outline-2">
<h2 id="initial">Initial</h2>
<div class="outline-text-2" id="text-initial">
<p>
In the example sxhkd in the bspwm repo, the main window focus keybind is
set up as such:
</p>

<div class="org-src-container">
<pre class="src src-bash">super + {<span style="color: #8e8e8e;">\_</span>,shift + }{h,j,k,l} bspc node -{f,s}
    {west,south,north,east}
</pre>
</div>

<p>
I'm going to separate this into 2 parts, a focus part and a movement
part.
</p>
</div>
</div>

<div id="outline-container-org2279c70" class="outline-2">
<h2 id="focus">Focus</h2>
<div class="outline-text-2" id="text-focus">
<p>
So taking the focus part out of the above we get: 
</p>
<pre class="example">
super + {h,j,k,l} 
    bspc node -f {west,south,north,east} 
</pre>

<p>
So, This will focus on a window in a direction determined by keypress,
which are vi-like here. However, lets say you have 2 monitors, and one
is empty:
</p>


<div class="figure">
<p><img src="http://i.imgur.com/5VBlIjn.png" alt="5VBlIjn.png" />
</p>
<p><span class="figure-number">Figure 1: </span>img</p>
</div>

<p>
the command <code>bspc node -f east</code> will fail, as there is no window to the
right, and no action occurs as a result.
</p>
</div>

<div id="outline-container-orgffda9ec" class="outline-3">
<h3 id="desired-behavior">Desired behavior</h3>
<div class="outline-text-3" id="text-desired-behavior">
<p>
In the above, on a focus right, I want the cursor to appear in the
middle of the right monitor as well as focus on that monitor.
</p>

<div class="org-src-container">
<pre class="src src-bash">super + {h,j,k,l}
    bspc config pointer_follows_monitor true; <span style="color: #8e8e8e;">\</span>
    bspc config pointer_follows_focus true; <span style="color: #8e8e8e;">\</span>
    <span style="color: #7c7c7c;">dir</span>={west,south,north,east}; <span style="color: #8e8e8e;">\</span>
        <span style="color: #747474;">if</span> <span style="color: #8e8e8e;">!</span> bspc node -f $<span style="color: #7c7c7c;">dir</span>; <span style="color: #747474;">then</span> <span style="color: #8e8e8e;">\</span>
    bspc monitor -f $<span style="color: #7c7c7c;">dir</span>; <span style="color: #8e8e8e;">\</span>
    <span style="color: #747474;">fi</span>; <span style="color: #8e8e8e;">\</span>
    bspc config pointer_follows_monitor false; <span style="color: #8e8e8e;">\</span>
    bspc config pointer_follows_focus false
</pre>
</div>

<p>
When the node right command fails in the above scenario, the monitor to
the right will be focused, and the pointer will be there.
</p>

<blockquote>
<p>
Why is half of this function setting pointer<sub>follows</sub><sub>*</sub> values?
</p>
</blockquote>

<p>
So let's say you are moving a floating window with your mouse across the
2 screens - with either of the two pointer options above enabled, when
you cross the border the cursor will move, and the window with it. This
window snapping out from under you can be quite annoying.
</p>
</div>
</div>
</div>

<div id="outline-container-orgf8b0c76" class="outline-2">
<h2 id="orgf8b0c76">Movement</h2>
<div class="outline-text-2" id="text-orgf8b0c76">
<p>
Movement part of the example sxhkd:
</p>

<div class="org-src-container">
<pre class="src src-bash">super + shift + {h,j,k,l}
    bspc node -s {west,south,north,east}
</pre>
</div>

<p>
Alright, so what this does is switch the currently focused window with
another window by direction, although the focus remains on the original
window spot, which I've found to be quite annoying. It feels more
natural to keep focus on the same window and 'carry' it around your
workspaces/monitors.
</p>
</div>

<div id="outline-container-orgc8e6dbc" class="outline-3">
<h3 id="desired-behavior-1">Desired behavior</h3>
<div class="outline-text-3" id="text-desired-behavior-1">
<p>
When a window is switched, retain focus on the original window that was
moved. If switching to an empty monitor, move the window to that
monitor. If switching to an occupied monitor, move the window to that
monitor instead of switching windows.
</p>

<p>
Under this behavior, the keypress <code>super + shift + l</code> would yield the
following results:
</p>

<p>
<img src="http://i.imgur.com/ofjhFSP.png" alt="ofjhFSP.png" /> <img src="http://i.imgur.com/HyahZTU.png" alt="HyahZTU.png" />
</p>

<p>
Here is an implementation:
</p>

<div class="org-src-container">
<pre class="src src-bash">super + shift + {h,j,k,l}
    bspc config pointer_follows_focus true; <span style="color: #8e8e8e;">\</span>
    <span style="color: #7c7c7c;">cur_win</span>=$(<span style="color: #686868;">bspc</span> query -W -w) <span style="color: #8e8e8e;">\</span>
    <span style="color: #7c7c7c;">cur_mon</span>=$(<span style="color: #686868;">bspc</span> query -M -m); <span style="color: #8e8e8e;">\</span>
    <span style="color: #7c7c7c;">dir</span>={west,south,north,east}; <span style="color: #8e8e8e;">\</span>
    <span style="color: #747474;">if</span> <span style="color: #8e8e8e;">!</span> bspc node -f $<span style="color: #7c7c7c;">dir</span>; <span style="color: #747474;">then</span> <span style="color: #8e8e8e;">\</span>
        bspc node -m $<span style="color: #7c7c7c;">dir</span>; <span style="color: #8e8e8e;">\</span>
        bspc monitor -f $<span style="color: #7c7c7c;">dir</span>; <span style="color: #8e8e8e;">\</span>
    <span style="color: #747474;">else</span> <span style="color: #8e8e8e;">\</span>
        <span style="color: #7c7c7c;">new_mon</span>=$(<span style="color: #686868;">bspc</span> query -M -m); <span style="color: #8e8e8e;">\</span>
        <span style="color: #747474;">if</span> [ $<span style="color: #7c7c7c;">new_mon</span> -eq $<span style="color: #7c7c7c;">cur_mon</span> ]; <span style="color: #747474;">then</span> <span style="color: #8e8e8e;">\</span>
            bspc node -s $<span style="color: #7c7c7c;">cur_win</span>; <span style="color: #8e8e8e;">\</span>
        <span style="color: #747474;">else</span> <span style="color: #8e8e8e;">\</span>
            bspc node $<span style="color: #7c7c7c;">cur_win</span> -m ^$<span style="color: #7c7c7c;">new_mon</span>; <span style="color: #8e8e8e;">\</span>
        <span style="color: #747474;">fi</span>; <span style="color: #8e8e8e;">\</span>
    bspc node -f $<span style="color: #7c7c7c;">cur_win</span>; <span style="color: #8e8e8e;">\</span>
    <span style="color: #747474;">fi</span>; <span style="color: #8e8e8e;">\</span>
    bspc config pointer_follows_focus false
</pre>
</div>

<p>
You can see from this I used the same strategy as above - check if the
window focus command failed and act accordingly - if it does not fail,
then check if we are on a new monitor - if so, move the original window
to the new monitor.
</p>

<p>
wooo.
</p>


<div class="org-center">
<p>
[ <a href="./index.html">Index</a> ¦ <a href="https://neeasade.net">Root</a> ]
</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
